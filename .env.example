# ==============================================================================
# Hookah Database API - Environment Variables Configuration
# ==============================================================================
# This file contains all environment variables used by Hookah Database API.
# Copy this file to .env for local development or use .env.dev/.env.prod for
# Docker deployments.
#
# For more information, see:
# - Docker setup: docker-compose.dev.yml, docker-compose.prod.yml
# - Logging documentation: docs/LOGGING.md
# - API documentation: http://localhost:3000/api-docs (when running)
# ==============================================================================

# ------------------------------------------------------------------------------
# APPLICATION CONFIGURATION
# ------------------------------------------------------------------------------
# Service name for identification in logs and monitoring
# Default: hookah-db
# Usage: Helps distinguish multiple service instances in logs
SERVICE_NAME=hookah-db

# Docker environment flag
# Options: true, false
# Default: false
# Usage: Set to true when running in Docker to enable Docker-specific features
# Note: Automatically set by docker-compose.yml files
DOCKER_ENABLED=false

# Container name (optional, for Docker environments)
# Default: hookah-db-api
# Usage: Helps identify containers in monitoring and logging
# Note: Only used when DOCKER_ENABLED=true
CONTAINER_NAME=hookah-db-api

# ------------------------------------------------------------------------------
# SERVER CONFIGURATION
# ------------------------------------------------------------------------------
# Port number for API server
# Default: 3000
# Usage: The HTTP port on which Express server listens
# Note: In Docker, this should match the exposed port in docker-compose.yml
PORT=3000

# ------------------------------------------------------------------------------
# EXTERNAL SERVICES
# ------------------------------------------------------------------------------
# Base URL for HTReviews.org (data source)
# Default: https://htreviews.org
# Usage: The root URL for scraping tobacco product data
# Note: Should not include trailing slash
HTREVIEWS_BASE_URL=https://htreviews.org

# ------------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ------------------------------------------------------------------------------
# SQLite database file path
# Default: ./hookah-db.db
# Usage: Path to SQLite database file for persistent data storage
# Examples:
#   - Local development: ./hookah-db.db (in project root)
#   - Docker container: /app/hookah-db.db (inside container)
#   - Custom location: /var/lib/hookah-db/hookah-db.db
# Note: The file will be created automatically if it doesn't exist
#       In Docker, ensure this is a volume mount for persistence
#       SQLite is used for data persistence instead of Redis cache
DATABASE_PATH=./hookah-db.db

# ------------------------------------------------------------------------------
# RATE LIMITING CONFIGURATION
# ------------------------------------------------------------------------------
# Rate limit time window in milliseconds
# Default: 60000 (1 minute)
# Usage: Time window for rate limiting requests
# Note: Adjust based on your API usage patterns and server capacity
RATE_LIMIT_WINDOW=60000

# Maximum number of requests per time window
# Default: 100
# Usage: Maximum requests allowed per IP address per time window
# Note: Set to 0 to disable rate limiting (not recommended for production)
RATE_LIMIT_MAX=100

# ------------------------------------------------------------------------------
# SCHEDULER CONFIGURATION
# ------------------------------------------------------------------------------
# Enable/disable cron scheduler
# Options: true, false
# Default: true
# Usage: Controls whether automatic data refresh jobs run
# Note: Set to false to disable automatic scraping (manual refresh only)
SCHEDULER_ENABLED=true

# Cron schedule for brands data refresh
# Format: minute hour day month weekday (cron expression)
# Default: 0 2 * * * (2:00 AM UTC daily)
# Usage: Schedule for automatic brands data refresh
# Examples:
#   - Every 6 hours: 0 */6 * * *
#   - Every Monday at 3 AM: 0 3 * * 1
#   - Disable: comment out or set to empty string
# Note: All times are in UTC unless timezone is specified in code
CRON_SCHEDULE_BRANDS=0 2 * * *

# Cron schedule for flavors data refresh
# Format: minute hour day month weekday (cron expression)
# Default: 0 3 * * * (3:00 AM UTC daily)
# Usage: Schedule for automatic flavors data refresh
# Examples:
#   - Every 6 hours: 0 */6 * * *
#   - Every Tuesday at 4 AM: 0 4 * * 2
#   - Disable: comment out or set to empty string
# Note: All times are in UTC unless timezone is specified in code
CRON_SCHEDULE_FLAVORS=0 3 * * *

# Cron schedule for full data refresh (brands + flavors)
# Format: minute hour day month weekday (cron expression)
# Default: 0 4 * * * (4:00 AM UTC daily)
# Usage: Schedule for complete data refresh
# Examples:
#   - Weekly on Sunday at 5 AM: 0 5 * * 0
#   - Monthly on 1st at 3 AM: 0 3 1 * *
#   - Disable: comment out or set to empty string
# Note: All times are in UTC unless timezone is specified in code
CRON_SCHEDULE_ALL=0 4 * * *

# Maximum number of execution history entries to keep
# Default: 100
# Usage: Limits size of scheduler execution history in memory
# Note: Higher values use more memory but provide more historical data
MAX_EXECUTION_HISTORY=100

# ------------------------------------------------------------------------------
# API-BASED FLAVOR EXTRACTION CONFIGURATION
# ------------------------------------------------------------------------------
# Enable/disable API-based flavor extraction
# Options: true, false
# Default: true
# Usage: Controls whether to use API-based extraction instead of HTML scraping
# Note: When enabled, extracts all flavors (not just first 20)
#       When disabled, falls back to HTML-based pagination (slower, limited)
ENABLE_API_EXTRACTION=true

# Number of flavors per API request
# Default: 20
# Usage: Number of flavors to fetch per API request
# Note: Higher values reduce number of requests but may increase response time
#       Recommended range: 10-50
API_FLAVORS_PER_REQUEST=20

# Delay between API requests in milliseconds
# Default: 500
# Usage: Controls rate limiting for API requests to be respectful to server
# Note: Lower values are faster but may trigger rate limiting
#       Recommended range: 300-1000
API_REQUEST_DELAY=500

# Maximum retry attempts for failed API requests
# Default: 3
# Usage: Number of retry attempts for failed API requests
# Note: Higher values increase resilience but also increase total extraction time
#       Recommended range: 2-5
API_MAX_RETRIES=3

# Enable/disable fallback to HTML scraping on API failure
# Options: true, false
# Default: true
# Usage: Controls whether to fall back to HTML scraping if API fails
# Note: When enabled, provides graceful degradation on API failures
#       When disabled, returns empty result on API failure
ENABLE_API_FALLBACK=true

# ------------------------------------------------------------------------------
# API KEYS
# ------------------------------------------------------------------------------
# API keys for client authentication
# Format: API_KEY_<CLIENT_NAME>=<key>
# Usage: Add one line per authorized client
# Examples:
#   API_KEY_CLIENT1=abc123def456
#   API_KEY_CLIENT2=xyz789uvw012
#   API_KEY_MOBILE_APP=mobile-key-123
# Note: Keys are validated via X-API-Key header in API requests
#       For production, use strong, randomly generated keys
#       Minimum length: 16 characters recommended
API_KEY_TEST=test-api-key-12345

# ------------------------------------------------------------------------------
# LOGGING CONFIGURATION
# ------------------------------------------------------------------------------
# Log level for application
# Options: error, warn, info, http, verbose, debug, silly
# Default: info
# Usage: Controls verbosity of log output
# Levels:
#   - error: Only errors
#   - warn: Errors and warnings
#   - info: Errors, warnings, and informational messages (recommended for production)
#   - http: Includes HTTP request/response logs
#   - verbose: More detailed operational information
#   - debug: Debug information (recommended for development)
#   - silly: All possible logs (maximum verbosity)
# Note: Lower levels include all higher levels (e.g., debug includes info, warn, error)
LOG_LEVEL=info

# Directory for log files (relative to project root or container)
# Default: ./logs
# Usage: Directory where log files are stored
# Examples:
#   - Local development: ./logs
#   - Docker container: /app/logs
#   - Absolute path: /var/log/hookah-db
# Note: Directory will be created if it doesn't exist
#       In Docker, ensure this is a volume mount for persistence
LOG_DIR=./logs

# Maximum log file size before rotation
# Default: 20m
# Usage: Maximum size of each log file before rotation
# Format: <size><unit> where unit can be k, m, or g
# Examples: 10m, 50m, 1g
# Note: Only applicable when using file rotation
MAX_LOG_FILE_SIZE=20m

# Maximum number of log files to keep
# Default: 14d
# Usage: How long to keep rotated log files
# Format: <number><unit> where unit can be d (days) or number of files
# Examples: 7d, 30d, 10 (files)
# Note: Only applicable when using file rotation
MAX_LOG_FILES=14d

# Enable/disable request/response logging
# Options: true, false
# Default: true
# Usage: Controls whether HTTP requests and responses are logged
# Note: Set to false to reduce log volume in high-traffic scenarios
LOG_HTTP_REQUESTS=true

# ------------------------------------------------------------------------------
# DOCKER-SPECIFIC NOTES
# ------------------------------------------------------------------------------
# When using Docker Compose:
#1. Use .env.dev for development: docker-compose -f docker-compose.dev.yml up
#2. Use .env.prod for production: docker-compose -f docker-compose.prod.yml up
#3. Ensure DATABASE_PATH is a volume mount for database persistence
#4. Ensure LOG_DIR is a volume mount for log persistence
#5. Set DOCKER_ENABLED=true for Docker-specific optimizations
#
# Docker Compose automatically loads environment variables from:
# - .env (default, for local development)
# - .env.dev (for development environment)
# - .env.prod (for production environment)
#
# Environment variable precedence (highest to lowest):
#1. Command line arguments (-e flag)
#2. Environment file specified in docker-compose.yml
#3. .env file in same directory as docker-compose.yml
#4. Shell environment variables
#
# Note: NODE_ENV is automatically set by Docker Compose:
#   - docker-compose.dev.yml sets NODE_ENV=development
#   - docker-compose.prod.yml sets NODE_ENV=production
#   - Do not set NODE_ENV in .env files when using Docker Compose
#
# For more information on Docker setup, see:
# - Dockerfile: Container image definition
# - docker-compose.dev.yml: Development environment configuration
# - docker-compose.prod.yml: Production environment configuration
# - .dockerignore: Files excluded from Docker build context

# ------------------------------------------------------------------------------
# LOCAL DEVELOPMENT NOTES
# ------------------------------------------------------------------------------
# For local development without Docker:
#1. Copy this file to .env: cp .env.example .env
#2. Adjust variables as needed for your environment
#3. Set DATABASE_PATH=./hookah-db.db (or custom path)
#4. Set LOG_LEVEL=debug for detailed logging
#5. Run with: pnpm --filter @hookah-db/api dev
#
# For testing API endpoints:
# - Start server: pnpm --filter @hookah-db/api dev
# - Access Swagger UI: http://localhost:3000/api-docs
# - Use API key: X-API-Key: test-api-key-12345
# - Health check: curl http://localhost:3000/health

# ------------------------------------------------------------------------------
# PRODUCTION DEPLOYMENT CHECKLIST
# ------------------------------------------------------------------------------
# Before deploying to production:
# [ ] Change all API_KEY_* values to strong, randomly generated keys
# [ ] Set LOG_LEVEL=info (or warn for reduced verbosity)
# [ ] Configure DATABASE_PATH for persistent storage
# [ ] Set DOCKER_ENABLED=true
# [ ] Review and adjust rate limiting (RATE_LIMIT_WINDOW, RATE_LIMIT_MAX)
# [ ] Configure scheduler schedules appropriately for your timezone
# [ ] Ensure DATABASE_PATH is a persistent volume mount
# [ ] Ensure LOG_DIR is a persistent volume mount
# [ ] Set up log rotation and monitoring
# [ ] Configure backup strategy for SQLite database file
# [ ] Review and test health check endpoints
# [ ] Set up proper error monitoring and alerting
# [ ] Configure HTTPS/TLS termination
