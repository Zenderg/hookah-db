[0;34m========================================[0m
[0;34mAPI Endpoint Testing with Real Data[0m
[0;34m========================================[0m

[1;33m1. Testing Health Endpoints (No Auth)[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.000842s] - GET /health (Expected: 200, Got: 200)
Response: {"status":"ok","timestamp":"2026-01-06T10:18:45.212Z"}

[0;32m‚úì PASS[0m [0.001330s] - GET /health/detailed (Expected: 200, Got: 200)
Response: {"status":"ok","timestamp":"2026-01-06T10:18:45.248Z","uptime":32190,"version":"1.0.0","database":{"path":"./hookah-db.db","brandsCount":40,"flavorsCount":0,"dbSize":4096}}


[1;33m2. Testing Documentation Endpoints (No Auth)[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.000799s] - GET /api-docs.json (Expected: 200, Got: 200)
Response size:    22522 bytes

[0;32m‚úì PASS[0m [0.000991s] - GET /api-docs/ (Swagger UI) (Expected: 200, Got: 200)


[1;33m3. Testing Authentication[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.000784s] - GET /api/v1/brands (No API Key) (Expected: 401, Got: 401)
[0;32m‚úì PASS[0m [0.000858s] - GET /api/v1/brands (Invalid API Key) (Expected: 403, Got: 403)
[0;32m‚úì PASS[0m [0.005102s] - GET /api/v1/brands (Valid API Key) (Expected: 200, Got: 200)

[1;33m4. Testing Brand Endpoints (Auth Required)[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.001445s] - GET /api/v1/brands?page=1&limit=10 (Expected: 200, Got: 200)
Response: {"data":[{"slug":"adam-i-eva","name":"–ê–¥–∞–º –∏ –ï–≤–∞","nameEn":"–ê–¥–∞–º –∏ –ï–≤–∞","description":"–°–ª–æ–≤–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é:\"–°–æ–∑–¥–∞–≤–∞—è —ç—Ç–æ—Ç —Ç–∞–±–∞–∫, –º—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–∏—Å—å –æ–ø—ã—Ç–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π —Å–∏–≥–∞—Ä –∏ —Ç—Ä—É–±–æ—á–Ω–æ–≥–æ 
[0;32m‚úì PASS[0m [0.000845s] - GET /api/v1/brands/sarma (Expected: 200, Got: 200)
Response: {"slug":"sarma","name":"–°–∞—Ä–º–∞","nameEn":"Sarma","description":"–ù–∞—à–∏ –∞—Ä–æ–º–∞—Ç—ã ‚Äî —ç—Ç–æ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è. –û–Ω–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç —Ç–µ–±—è –≤ –ª–µ—Ç–Ω–∏–π –¥–≤–æ—Ä –Ω–∞ –∫–∞–Ω–∏–∫—É–ª–∞—Ö, –∫ –≤–µ—á–µ—Ä–Ω–µ–º—É –∫–æ—Å—Ç—Ä—É, –≤ –ø–µ—Ä–≤—É—é –ø–æ–µ–∑–¥–∫—É –Ω–∞ –º–æ
[0;32m‚úì PASS[0m [0.000840s] - GET /api/v1/brands/dogma (Expected: 200, Got: 200)
Response: {"slug":"dogma","name":"–î–æ–≥–º–∞","nameEn":"Dogma","description":"–ë—Ä–µ–Ω–¥ —Ç–∞–±–∞–∫–∞ –¥–ª—è –∫–∞–ª—å—è–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–≥–∞—Ä–Ω–æ–≥–æ —Ç–∞–±–∞—á–Ω–æ–≥–æ –ª–∏—Å—Ç–∞. –ò–∑–≤–µ—Å—Ç–µ–Ω –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º–∏ –∞—Ä–æ–º–∞—Ç–∞–º–∏ –∏ –±–µ–∑–∞—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±–ª–
[0;31m‚úó FAIL[0m [0.001022s] - GET /api/v1/brands/sarma/flavors (Expected: 200, Got: 404)
Response: {"error":"Error","message":"No flavors found for brand with slug 'sarma'","stack":"Error: No flavors found for brand with slug 'sarma'\n    at getFlavorsByBrand (/Users/koshmarus/Projects/hookah-db/apps/api/src/controllers/flavor-controller.ts:243:21)\n    at processTicksAndRejections (nod
[0;32m‚úì PASS[0m [18.369988s] - POST /api/v1/brands/refresh (Expected: 200, Got: 200)
Response: {"success":true,"message":"Brand data refreshed successfully","data":[{"slug":"adam-i-eva","name":"–ê–¥–∞–º –∏ –ï–≤–∞","nameEn":"–ê–¥–∞–º –∏ –ï–≤–∞","description":"–°–ª–æ–≤–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é:\"–°–æ–∑–¥–∞–≤–∞—è —ç—Ç–æ—Ç —Ç–∞–±–∞–∫, –º—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–∏—Å—å –æ–ø—ã—Ç–æ–º –ø—

[1;33m5. Testing Flavor Endpoints (Auth Required)[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.001040s] - GET /api/v1/flavors?page=1&limit=10 (Expected: 200, Got: 200)
Response: {"data":[],"pagination":{"page":1,"limit":10,"total":0,"totalPages":0}}

[0;31m‚úó FAIL[0m [0.001065s] - GET /api/v1/flavors/zima (Expected: 200, Got: 404)
Response: {"error":"Error","message":"Flavor with slug 'zima' not found","stack":"Error: Flavor with slug 'zima' not found\n    at getFlavorBySlug (/Users/koshmarus/Projects/hookah-db/apps/api/src/controllers/flavor-controller.ts:181:21)\n    at processTicksAndRejections (node:internal/process/task_
[0;32m‚úì PASS[0m [17.417934s] - POST /api/v1/flavors/refresh (Expected: 200, Got: 200)
Response: {"success":true,"message":"Flavor data refreshed successfully","data":[]}


[1;33m6. Testing Scheduler Endpoints (Auth Required)[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.000765s] - GET /api/v1/scheduler/stats (Expected: 200, Got: 200)
Response: {"isRunning":true,"tasksCount":3,"activeTasksCount":3,"totalRuns":1,"totalErrors":0,"averageExecutionTime":26561,"uptime":32261105}

[0;32m‚úì PASS[0m [0.000731s] - GET /api/v1/scheduler/jobs (Expected: 200, Got: 200)
Response: {"jobs":[{"id":"task-1-1767662536595","name":"brands-refresh","enabled":true,"lastRun":"2026-01-06T02:00:00.616Z","totalRuns":1,"errorCount":0},{"id":"task-2-1767662536601","name":"flavors-refresh","enabled":true,"totalRuns":0,"errorCount":0},{"id":"task-3-1767662536601","name":"all-data-r

[1;33m7. Testing Error Handling[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.000898s] - GET /api/v1/brands/nonexistent (Expected: 404, Got: 404)
Response: {"error":"NotFoundError","message":"Brand with slug 'nonexistent' not found","stack":"NotFoundError: Brand with slug 'nonexistent' not found\n    at getBrandBySlug (/Users/koshmarus/Projects/hookah-db/apps/api/src/controllers/brand-controller.ts:171:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"}

[0;32m‚úì PASS[0m [0.000770s] - GET /api/v1/flavors/nonexistent (Expected: 404, Got: 404)
Response: {"error":"Error","message":"Flavor with slug 'nonexistent' not found","stack":"Error: Flavor with slug 'nonexistent' not found\n    at getFlavorBySlug (/Users/koshmarus/Projects/hookah-db/apps/api/src/controllers/flavor-controller.ts:181:21)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"}

[0;32m‚úì PASS[0m [0.000737s] - GET /api/v1/brands/nonexistent/flavors (Expected: 404, Got: 404)
Response: {"error":"Error","message":"No flavors found for brand with slug 'nonexistent'","stack":"Error: No flavors found for brand with slug 'nonexistent'\n    at getFlavorsByBrand (/Users/koshmarus/Projects/hookah-db/apps/api/src/controllers/flavor-controller.ts:243:21)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"}


[1;33m8. Testing Pagination and Filtering[0m
[1;33m----------------------------------------[0m
[0;32m‚úì PASS[0m [0.001112s] - GET /api/v1/brands?page=2&limit=10 (Expected: 200, Got: 200)
Response: {"data":[{"slug":"deus","name":"Deus","nameEn":"–î–µ—É—Å","description":"–¢–∞–±–∞–∫ –∏–∑ –†–æ—Å—Å–∏–∏ –æ—Ç –∫–æ–º–∞–Ω–¥—ã HookahPlace –∏ JohnCalliano.","country":"–†–æ—Å—Å–∏—è","website":"https://t.me/deus_tobacco","foundedYear":2022,"status":"–í—ã–ø—É—Å–∫–∞–µ—Ç—Å—è","imageUrl":"https://ht
[0;32m‚úì PASS[0m [0.000661s] - GET /api/v1/flavors?brandSlug=sarma (Expected: 200, Got: 200)
Response: {"data":[],"pagination":{"page":1,"limit":20,"total":0,"totalPages":0}}


[1;33m9. Testing Data Validation[0m
[1;33m----------------------------------------[0m
Validating Sarma brand data structure:
[0;32m‚úì[0m Has slug field
[0;32m‚úì[0m Has name field
[0;32m‚úì[0m Has country field
[0;32m‚úì[0m Has rating field

Validating Winter (zima) flavor data structure:
[0;31m‚úó[0m Missing slug field
[0;31m‚úó[0m Missing name field
[0;31m‚úó[0m Missing brandSlug field
[0;31m‚úó[0m Missing rating field
[0;31m‚úó[0m Missing tags field

[0;34m========================================[0m
[0;34mTest Summary[0m
[0;34m========================================[0m
Total Tests: 22
[0;32mPassed: 20[0m
[0;31mFailed: 2[0m

[0;31mSome tests failed![0m
